"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[126],{1224(e,s,a){a.r(s),a.d(s,{assets:()=>d,contentTitle:()=>i,default:()=>l,frontMatter:()=>t,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"manual-do-dev/projetos/e-sus-urgencias/criacao-de-cruds","title":"Cria\xe7\xe3o de CRUDs","description":"Esta p\xe1gina cont\xe9m as instru\xe7\xf5es para a cria\xe7\xe3o dos endpoints b\xe1sico para CRUDs em entitades dentro do sistema E-SUS urg\xeancias.","source":"@site/docs/02-manual-do-dev/projetos/e-sus-urgencias/criacao-de-cruds.md","sourceDirName":"02-manual-do-dev/projetos/e-sus-urgencias","slug":"/manual-do-dev/projetos/e-sus-urgencias/criacao-de-cruds","permalink":"/docs-preview/docs/manual-do-dev/projetos/e-sus-urgencias/criacao-de-cruds","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/02-manual-do-dev/projetos/e-sus-urgencias/criacao-de-cruds.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Como executar scripts DML nos ambientes do e-SUS (DataSUS)","permalink":"/docs-preview/docs/manual-do-dev/projetos/e-sus-urgencias/como-executar-scripts-dml-nos-ambientes-do-e-sus-datasus"},"next":{"title":"Documenta\xe7\xe3o Front-End - Atomic Design","permalink":"/docs-preview/docs/manual-do-dev/projetos/e-sus-urgencias/documentacao-front-end-atomic-design"}}');var r=a(4848),o=a(8453);const t={},i="Cria\xe7\xe3o de CRUDs",d={},c=[{value:"Esta p\xe1gina cont\xe9m as instru\xe7\xf5es para a cria\xe7\xe3o dos endpoints b\xe1sico para CRUDs em entitades dentro do sistema E-SUS urg\xeancias.",id:"esta-p\xe1gina-cont\xe9m-as-instru\xe7\xf5es-para-a-cria\xe7\xe3o-dos-endpoints-b\xe1sico-para-cruds-em-entitades-dentro-do-sistema-e-sus-urg\xeancias",level:5},{value:"- Cria\xe7\xe3o da estrutura b\xe1sica",id:"--cria\xe7\xe3o-da-estrutura-b\xe1sica",level:5},{value:"- Defini\xe7\xf5es da Entidade e DTOs",id:"--defini\xe7\xf5es-da-entidade-e-dtos",level:5},{value:"- Defini\xe7\xf5es dos services e controllers",id:"--defini\xe7\xf5es-dos-services-e-controllers",level:5},{value:"- Inje\xe7\xf5es de depend\xeancia e m\xf3dulos",id:"--inje\xe7\xf5es-de-depend\xeancia-e-m\xf3dulos",level:5},{value:"- Swagger e ducumenta\xe7\xe3o",id:"--swagger-e-ducumenta\xe7\xe3o",level:5}];function m(e){const s={a:"a",code:"code",h1:"h1",h5:"h5",header:"header",img:"img",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"cria\xe7\xe3o-de-cruds",children:"Cria\xe7\xe3o de CRUDs"})}),"\n",(0,r.jsx)(s.h5,{id:"esta-p\xe1gina-cont\xe9m-as-instru\xe7\xf5es-para-a-cria\xe7\xe3o-dos-endpoints-b\xe1sico-para-cruds-em-entitades-dentro-do-sistema-e-sus-urg\xeancias",children:"Esta p\xe1gina cont\xe9m as instru\xe7\xf5es para a cria\xe7\xe3o dos endpoints b\xe1sico para CRUDs em entitades dentro do sistema E-SUS urg\xeancias."}),"\n",(0,r.jsx)(s.h5,{id:"--cria\xe7\xe3o-da-estrutura-b\xe1sica",children:"- Cria\xe7\xe3o da estrutura b\xe1sica"}),"\n",(0,r.jsx)(s.p,{children:"O nestJS fornece um CLI (command-line interface) que facilita o scaffolding de uma nova entidade no sistema. Neste documento, teremos as instru\xe7\xf5es b\xe1sicas para cria\xe7\xe3o da estrutura que precisaremos para implementa\xe7\xe3o de endpoints de CRUD."}),"\n",(0,r.jsx)(s.p,{children:"Primeiramente, precisamos instalar o Nest CLI. Para isso, podemos executar o seguinte comando:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"$ npm install -g @nestjs/cli\n"})}),"\n",(0,r.jsx)(s.p,{children:"Ap\xf3s a instala\xe7\xe3o, podemos verificar se a instala\xe7\xe3o foi bem sucedida com o seguinte comando:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"nest --version\n"})}),"\n",(0,r.jsx)(s.p,{children:"Em caso de sucesso, a vers\xe3o atual do NestCLI deve aparecer:"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://ajuda.digitalsys.com.br/uploads/images/gallery/2025-01/6wCm1xTfgv3aa784-image.png",children:(0,r.jsx)(s.img,{src:"https://ajuda.digitalsys.com.br/uploads/images/gallery/2025-01/scaled-1680-/6wCm1xTfgv3aa784-image.png",alt:"image.png"})})}),"\n",(0,r.jsxs)(s.p,{children:["Ap\xf3s isso, dentro do reposit\xf3rio do projeto, navege, utilizando o terminal, at\xe9 o diret\xf3rio /backend. Uma vez dentro desse diret\xf3rio, utilize os seguintes comando para cria\xe7\xe3o do ",(0,r.jsx)(s.strong,{children:"Module"}),", ",(0,r.jsx)(s.strong,{children:"Service"}),", e ",(0,r.jsx)(s.strong,{children:"Controller"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["Para mais informa\xe7\xf5es sobre o NestCLI, podemos consultar a documenta\xe7\xe3o oficial em: ",(0,r.jsx)(s.a,{href:"https://docs.nestjs.com/cli/overview",children:"https://docs.nestjs.com/cli/overview"})]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"OBS:"}),' Nesse exemplo, queremos criar uma entidade "Time/Equipe", que aqui chamaremos de /team. Substitua esse nome pelo nome do m\xf3dulo que deseja criar']}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"nest generate module /team\n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"nest generate service /team\n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"nest generate controller /team\n"})}),"\n",(0,r.jsx)(s.p,{children:'Ao inserir cada comando, ser\xe1 solicitado em qual projeto queremos criar esse novo m\xf3dulo. Nesse caso, selecionaremos "api"'}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://ajuda.digitalsys.com.br/uploads/images/gallery/2025-01/kLZ9i2KeG3GMS9fO-image.png",children:(0,r.jsx)(s.img,{src:"https://ajuda.digitalsys.com.br/uploads/images/gallery/2025-01/scaled-1680-/kLZ9i2KeG3GMS9fO-image.png",alt:"image.png"})})}),"\n",(0,r.jsx)(s.p,{children:"Feito isso, teremos a seguinte estrutura dentro de /backend/apps/api/src"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://ajuda.digitalsys.com.br/uploads/images/gallery/2025-01/JR054EHAjO3erLc2-image.png",children:(0,r.jsx)(s.img,{src:"https://ajuda.digitalsys.com.br/uploads/images/gallery/2025-01/scaled-1680-/JR054EHAjO3erLc2-image.png",alt:"image.png"})})}),"\n",(0,r.jsxs)(s.p,{children:["Note que uma pasta ",(0,r.jsx)(s.strong,{children:"/team"})," foi criada dentro de ",(0,r.jsx)(s.strong,{children:"/src"}),", bem como nosso service, controller e module."]}),"\n",(0,r.jsxs)(s.p,{children:["Para finalizar, dentro de ",(0,r.jsx)(s.strong,{children:"/team"})," vamos criar o diret\xf3rio ",(0,r.jsx)(s.strong,{children:"/dto"})," e ",(0,r.jsx)(s.strong,{children:"/entities"}),", para armazenar, respectivamente, os ",(0,r.jsx)(s.strong,{children:"DTOs"})," (Data transfer objects) e nossa defini\xe7\xe3o de ",(0,r.jsx)(s.strong,{children:"Entidade"}),". Ademais, criaremos ",(0,r.jsx)(s.strong,{children:"manualmente"}),", dentre de seus respectivos diret\xf3rios, os arquivos ",(0,r.jsx)(s.strong,{children:"team.dto.ts"})," e ",(0,r.jsx)(s.strong,{children:"team.entity.ts"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["Por fim, teremos a seguinte estrutura dentro de ",(0,r.jsx)(s.strong,{children:"/team"}),":"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"OBS:"})," Arquivos com a extens\xe3o ",(0,r.jsx)(s.strong,{children:".spec"})," s\xe3o arquivos de teste. Eles s\xe3o gerados automaticamente pelo CLI do nestJS. Vamos apag\xe1-los, por momento. Podemos recri\xe1-los manualmente, futuramente, caso presisemos."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://ajuda.digitalsys.com.br/uploads/images/gallery/2025-01/7zEoIOcXeWJYnZbF-image.png",children:(0,r.jsx)(s.img,{src:"https://ajuda.digitalsys.com.br/uploads/images/gallery/2025-01/scaled-1680-/7zEoIOcXeWJYnZbF-image.png",alt:"image.png"})})}),"\n",(0,r.jsx)(s.h5,{id:"--defini\xe7\xf5es-da-entidade-e-dtos",children:"- Defini\xe7\xf5es da Entidade e DTOs"}),"\n",(0,r.jsxs)(s.p,{children:["Primeiramente, devemos declarar quais atributos nossa entidade ter\xe1. Para isso, dentro de ",(0,r.jsx)(s.strong,{children:"team.entity.ts"}),", devemos ter:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-javascript",children:"import { Entity, Column, PrimaryGeneratedColumn } from 'typeorm';\n\n@Entity()\nexport class Team {\n  @PrimaryGeneratedColumn()\n  id: number;\n\n  @Column()\n  name: string;\n}\n"})}),"\n",(0,r.jsxs)(s.p,{children:['Atente-se que o NestJS \xe9 "database agnostic", ou seja, ele n\xe3o possui um ORM padr\xe3o. No projeto do E-SUS Urg\xeancias, estamos utilizando o ',(0,r.jsx)(s.strong,{children:"TypeORM"}),". Podemos dizer que essa classe \xe9 uma entidade usando o decorator ",(0,r.jsx)(s.strong,{children:"@Entity()"}),". Aqui estamos apenas declarando 2 campos b\xe1sicos, ",(0,r.jsx)(s.strong,{children:"id"})," e ",(0,r.jsx)(s.strong,{children:"name"}),". Cada atributo \xe9 precedido por um decorator para definir o comportamento daquele atributo. Para mais informa\xe7\xf5es sobre os decorators, visite: ",(0,r.jsx)(s.a,{href:"https://typeorm.io/entities",children:"https://typeorm.io/entities"})]}),"\n",(0,r.jsxs)(s.p,{children:["Ademais, vamos criar o seguinte DTO dentro de ",(0,r.jsx)(s.strong,{children:"team.dto.ts:"})]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-javascript",children:"export class CreateTeamDto {\n  name: string;\n}\n"})}),"\n",(0,r.jsx)(s.h5,{id:"--defini\xe7\xf5es-dos-services-e-controllers",children:"- Defini\xe7\xf5es dos services e controllers"}),"\n",(0,r.jsxs)(s.p,{children:["Agora, podemos come\xe7ar a definir os nossos services, para tal, dentro de ",(0,r.jsx)(s.strong,{children:"team.service.ts"}),", podemos adicionar o seguinte:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-javascript",children:"import { Injectable } from '@nestjs/common';\nimport { InjectRepository } from '@nestjs/typeorm';\nimport { Repository } from 'typeorm';\nimport { Team } from './entities/team.entity';\nimport { CreateTeamDTO } from './dto/team.dto';\n\n@Injectable()\nexport class TeamService {\n  constructor(\n    @InjectRepository(Team)\n    private teamRepository: Repository&lt;Team>,\n  ) {}\n\n  // Create\n  async create(createTeamDto: CreateTeamDTO): Promise&lt;Team> {\n    const team = this.teamRepository.create(createTeamDto);\n    return this.teamRepository.save(team);\n  }\n\n  // Retrieve\n  async findAll(): Promise&lt;Team[]> {\n    return this.teamRepository.find();\n  }\n\n  // Update\n  async update(id: number, updateTeamDto: CreateTeamDTO): Promise&lt;Team> {\n    const team = await this.teamRepository.findOne({ where: { id } });\n    if (!team) {\n      throw new Error('Equipe n\xe3o encontrada');\n    }\n    this.teamRepository.merge(team, updateTeamDto);\n    return this.teamRepository.save(team);\n  }\n\n  // Delete\n  async delete(id: number): Promise&lt;Team> {\n    const team = await this.teamRepository.findOne({ where: { id } });\n    if (!team) {\n      throw new Error('Equipe n\xe3o encontrada');\n    }\n    return this.teamRepository.remove(team);\n  }\n}\n"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"OBS:"})," Note que essa s\xe3o opera\xe7\xf5es simples de CRUD. Altera\xe7\xf5es no fluxo e tratamentos de erro devem ser feitos conforme as regras de neg\xf3cio."]}),"\n",(0,r.jsxs)(s.p,{children:["Da mesma forma, podemos definir nossos endpoints em ",(0,r.jsx)(s.strong,{children:"team.controller.ts"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-javascript",children:"import { Controller, Post, Body, Get, Put, Delete, Param } from '@nestjs/common';\nimport { TeamService } from './team.service';\nimport { CreateTeamDTO } from './dto/team.dto';\nimport { Team } from './entities/team.entity';\n\n@Controller('team')\nexport class TeamController {\n  constructor(private readonly teamService: TeamService) {}\n\n  @Post()\n  async create(@Body() createTeamDto: CreateTeamDTO): Promise&lt;Team> {\n    return this.teamService.create(createTeamDto);\n  }\n\n  @Get()\n  async findAll(): Promise&lt;Team[]> {\n    return this.teamService.findAll();\n  }\n\n  @Put(':id')\n  async update(\n    @Param('id') id: number,\n    @Body() updateTeamDto: CreateTeamDTO\n  ): Promise&lt;Team> {\n    return this.teamService.update(id, updateTeamDto);\n  }\n\n  @Delete(':id')\n  async delete(@Param('id') id: number): Promise&lt;Team> {\n    return this.teamService.delete(id);\n  }\n}\n"})}),"\n",(0,r.jsx)(s.p,{children:"Assim, teremos as seguintes rotas:"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"POST"})," http://<api-url>/team"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"GET"})," http://<api-url>/team"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"PUT"})," http://<api-url>/team/",":id"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"DELETE"})," http://<api-url>/team/",":id"]}),"\n",(0,r.jsx)(s.h5,{id:"--inje\xe7\xf5es-de-depend\xeancia-e-m\xf3dulos",children:"- Inje\xe7\xf5es de depend\xeancia e m\xf3dulos"}),"\n",(0,r.jsxs)(s.p,{children:['Por fim, devemos integrar nosso novo m\xf3dulo "team" com nosso m\xf3dulo de aplica\xe7\xe3o principal, al\xe9m de injetar as depend\xeancias que nosso service solicita (no nosso caso, o reposit\xf3rio). Para tal, dentro de ',(0,r.jsx)(s.strong,{children:"team.module.ts"})," vamos adicionar o seguinte:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-javascript",children:"import { Module } from '@nestjs/common';\nimport { TeamService } from './team.service';\nimport { TeamController } from './team.controller';\nimport { TypeOrmModule } from '@nestjs/typeorm';\nimport { Team } from './entities/team.entity';\n\n@Module({\n  imports: [TypeOrmModule.forFeature([Team])],\n  providers: [TeamService],\n  controllers: [TeamController]\n})\nexport class TeamModule {}\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Por fim, dentro de ",(0,r.jsx)(s.strong,{children:"/src/app.module.ts"}),' devemos adicionar nossa entidade dentro da lista "entities". Ademais, devemos conferir se nosso m\xf3dulo "TeamModule" foi importando dentro do m\xf3dulo principal (O nestCLI deve fazer isso automaticamente, mas \xe9 sempre legal conferir).']}),"\n",(0,r.jsx)(s.p,{children:"Teremos:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-javascript",children:"import { Module } from '@nestjs/common';\nimport { TypeOrmModule } from '@nestjs/typeorm';\nimport { ItemsModule } from './items/items.module';\nimport { KafkaService } from './kafka/kafka.service';\nimport { Item } from './items/entities/item.entity';\nimport { Ambulance } from './ambulance/entities/ambulance.entity';\nimport { Profile } from './profile/entities/profile.entity';\nimport { CallSource } from './call_source/entities/call_source.entity';\nimport { CallType } from './call_type/entities/call_type.entity';\nimport { JobTitle } from './job_title/entities/job_title.entity';\nimport { Team } from './team/entities/team.entity';\nimport { Occurrence } from './occurrence/entities/occurence.entity';\nimport { AmbulanceModule } from './ambulance/ambulance.module';\nimport { ProfileModule } from './profile/profile.module';\nimport { CallSourceModule } from './call_source/call_source.module';\nimport { CallTypeModule } from './call_type/call_type.module';\nimport { JobTitleModule } from './job_title/job_title.module';\nimport { OccurrenceModule } from './occurrence/occurrence.module';\nimport { TeamModule } from './team/team.module';\n\n@Module({\n  imports: [\n    TypeOrmModule.forRoot({\n      type: &lt;type>,\n      host: process.env.DB_HOST || &lt;host>,\n      port: parseInt(process.env.DB_PORT) || ,\n      username: process.env.DB_USER || &lt;username>,\n      password: process.env.DB_PASSWORD || ,\n      database: process.env.DB_NAME || &lt;databaseName>,\n      entities: [Item, Ambulance, Profile, CallSource, CallType, JobTitle, Occurrence, Team],\n      synchronize: true,\n      autoLoadEntities: true,\n    }),\n    ItemsModule,\n    AmbulanceModule,\n    ProfileModule,\n    CallSourceModule,\n    CallTypeModule,\n    JobTitleModule,\n    OccurrenceModule,\n    TeamModule,\n  ],\n  providers: [KafkaService],\n})\nexport class AppModule {}\n"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"OBS"}),": Note que algumas informa\xe7\xf5es foram ocultadas e substituidas por ",(0,r.jsx)(s.strong,{children:"<something>"}),", n\xe3o estando sintaticamente corretas."]}),"\n",(0,r.jsx)(s.p,{children:"Finalmente, podemos buildar nosso projeto e testar nossos endpoints:"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"POST:"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://ajuda.digitalsys.com.br/uploads/images/gallery/2025-01/ISKTSZ0DVC6gRvw9-image.png",children:(0,r.jsx)(s.img,{src:"https://ajuda.digitalsys.com.br/uploads/images/gallery/2025-01/scaled-1680-/ISKTSZ0DVC6gRvw9-image.png",alt:"image.png"})})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"GET:"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://ajuda.digitalsys.com.br/uploads/images/gallery/2025-01/yIEszPDBI9NtbFEW-image.png",children:(0,r.jsx)(s.img,{src:"https://ajuda.digitalsys.com.br/uploads/images/gallery/2025-01/scaled-1680-/yIEszPDBI9NtbFEW-image.png",alt:"image.png"})})}),"\n",(0,r.jsx)(s.h5,{id:"--swagger-e-ducumenta\xe7\xe3o",children:"- Swagger e ducumenta\xe7\xe3o"}),"\n",(0,r.jsx)(s.p,{children:"O m\xf3dulo no swagger do nestJS est\xe1 configurado para adicionar automaticamente qualquer endpoint criado \xe0 documenta\xe7\xe3o swagger. Para acessar a documenta\xe7\xe3o, acesse a url http://<api-url>/api (link padr\xe3o) ou o link que estiver indicado pela vari\xe1vel SWAGGER_URL"})]})}function l(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(m,{...e})}):m(e)}},8453(e,s,a){a.d(s,{R:()=>t,x:()=>i});var n=a(6540);const r={},o=n.createContext(r);function t(e){const s=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),n.createElement(o.Provider,{value:s},e.children)}}}]);
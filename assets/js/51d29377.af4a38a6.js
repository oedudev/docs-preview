"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[8713],{2796(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>d,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"manual-do-devops/ci-cd/runners-k8s","title":"\ud83c\udfc3\u200d\u2642\ufe0f GitHub Actions Runners no Kubernetes (ARC)","description":"Utilizamos o Actions Runner Controller (ARC) para gerenciar runners auto-hospedados no cluster Kubernetes. Isso permite escalabilidade din\xe2mica e economia de custos.","source":"@site/docs/03-manual-do-devops/ci-cd/runners-k8s.md","sourceDirName":"03-manual-do-devops/ci-cd","slug":"/manual-do-devops/ci-cd/runners-k8s","permalink":"/docs-preview/docs/manual-do-devops/ci-cd/runners-k8s","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/03-manual-do-devops/ci-cd/runners-k8s.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\ud83d\udd10 Gest\xe3o de Segredos: Vault & External Secrets","permalink":"/docs-preview/docs/manual-do-devops/agentes-ia/seguranca-vault"},"next":{"title":"\ud83d\ude9a Guia de Migra\xe7\xe3o: Legado (Droplet) para Kubernetes","permalink":"/docs-preview/docs/manual-do-devops/guias/migracao-legado-k8s"}}');var o=s(4848),i=s(8453);const d={},a="\ud83c\udfc3\u200d\u2642\ufe0f GitHub Actions Runners no Kubernetes (ARC)",l={},c=[{value:"Arquitetura",id:"arquitetura",level:2},{value:"Tipos de Runners",id:"tipos-de-runners",level:2},{value:"1. Runner Padr\xe3o (<code>runs-on: self-hosted</code>)",id:"1-runner-padr\xe3o-runs-on-self-hosted",level:3},{value:"2. Runner Docker-in-Docker (<code>dind</code>)",id:"2-runner-docker-in-docker-dind",level:3},{value:"Autoscaling",id:"autoscaling",level:2},{value:"Manuten\xe7\xe3o",id:"manuten\xe7\xe3o",level:2},{value:"Verificar Status",id:"verificar-status",level:3},{value:"Logs de Erro",id:"logs-de-erro",level:3},{value:"Atualiza\xe7\xe3o da Imagem do Runner",id:"atualiza\xe7\xe3o-da-imagem-do-runner",level:3}];function t(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"\ufe0f-github-actions-runners-no-kubernetes-arc",children:"\ud83c\udfc3\u200d\u2642\ufe0f GitHub Actions Runners no Kubernetes (ARC)"})}),"\n",(0,o.jsxs)(n.p,{children:["Utilizamos o ",(0,o.jsx)(n.strong,{children:"Actions Runner Controller (ARC)"})," para gerenciar runners auto-hospedados no cluster Kubernetes. Isso permite escalabilidade din\xe2mica e economia de custos."]}),"\n",(0,o.jsx)(n.h2,{id:"arquitetura",children:"Arquitetura"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Controller:"})," Roda no cluster e monitora a fila de jobs do GitHub."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"ScaleSet:"})," Define um grupo de runners que escalam juntos."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Runner Pods:"})," Pods ef\xeameros criados para executar jobs."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"tipos-de-runners",children:"Tipos de Runners"}),"\n",(0,o.jsxs)(n.h3,{id:"1-runner-padr\xe3o-runs-on-self-hosted",children:["1. Runner Padr\xe3o (",(0,o.jsx)(n.code,{children:"runs-on: self-hosted"}),")"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Pool:"})," ",(0,o.jsx)(n.code,{children:"shared"})," (Nodes ",(0,o.jsx)(n.code,{children:"s-8vcpu-16gb"}),")."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Caracter\xedsticas:"})," Leves, r\xe1pidos de subir."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Uso:"})," Linter, Testes Unit\xe1rios, Builds simples."]}),"\n"]}),"\n",(0,o.jsxs)(n.h3,{id:"2-runner-docker-in-docker-dind",children:["2. Runner Docker-in-Docker (",(0,o.jsx)(n.code,{children:"dind"}),")"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Pool:"})," ",(0,o.jsx)(n.code,{children:"runner-general"})," (Nodes ",(0,o.jsx)(n.code,{children:"s-4vcpu-8gb"}),")."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Caracter\xedsticas:"})," General Purpose, custo-benef\xedcio otimizado."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Autoscaling:"})," M\xednimo 1 runner sempre ativo (resposta r\xe1pida)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Privil\xe9gio:"})," ",(0,o.jsx)(n.code,{children:"privileged: true"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Uso:"})," Builds de imagens Docker (",(0,o.jsx)(n.code,{children:"docker build"}),", ",(0,o.jsx)(n.code,{children:"docker push"}),")."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"autoscaling",children:"Autoscaling"}),"\n",(0,o.jsxs)(n.p,{children:["O ARC est\xe1 configurado para escalar de ",(0,o.jsx)(n.strong,{children:"0 a N"})," r\xe9plicas."]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Min Replicas:"})," 0 (Economia total quando ocioso)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Max Replicas:"})," Definido no ",(0,o.jsx)(n.code,{children:"AutoscalingRunnerSet"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Quando um job entra na fila, o ARC cria um Pod. Quando o job termina, o Pod \xe9 destru\xeddo."}),"\n",(0,o.jsx)(n.h2,{id:"manuten\xe7\xe3o",children:"Manuten\xe7\xe3o"}),"\n",(0,o.jsx)(n.h3,{id:"verificar-status",children:"Verificar Status"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl get autoscalingrunnerset -n runners\nkubectl get pods -n runners\n"})}),"\n",(0,o.jsx)(n.h3,{id:"logs-de-erro",children:"Logs de Erro"}),"\n",(0,o.jsx)(n.p,{children:"Se um runner n\xe3o sobe:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl describe pod &lt;runner-pod> -n runners\nkubectl logs -n runners-system deployment/arc-gha-rs-controller\n"})}),"\n",(0,o.jsx)(n.h3,{id:"atualiza\xe7\xe3o-da-imagem-do-runner",children:"Atualiza\xe7\xe3o da Imagem do Runner"}),"\n",(0,o.jsxs)(n.p,{children:["As imagens dos runners s\xe3o definidas no CRD ",(0,o.jsx)(n.code,{children:"AutoscalingRunnerSet"}),". Para atualizar a vers\xe3o do runner ou ferramentas, edite o manifesto e aplique."]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(t,{...e})}):t(e)}},8453(e,n,s){s.d(n,{R:()=>d,x:()=>a});var r=s(6540);const o={},i=r.createContext(o);function d(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:d(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);
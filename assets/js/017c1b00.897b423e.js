"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[4789],{2530(e,a,s){s.r(a),s.d(a,{assets:()=>d,contentTitle:()=>t,default:()=>m,frontMatter:()=>r,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"manual-do-dev/projetos/e-sus-urgencias/integracao-com-o-sistema-de-telefonia-digitro","title":"Integra\xe7\xe3o com o sistema de Telefonia (Digitro)","description":"Este documento descreve a integra\xe7\xe3o do sistema de telefonia com o frontend da aplica\xe7\xe3o, realizada em parceria com a empresa Digitro. O objetivo principal dessa integra\xe7\xe3o \xe9 permitir que os usu\xe1rios efetuem e recebam chamadas diretamente pela interface web.","source":"@site/docs/02-manual-do-dev/projetos/e-sus-urgencias/integracao-com-o-sistema-de-telefonia-digitro.md","sourceDirName":"02-manual-do-dev/projetos/e-sus-urgencias","slug":"/manual-do-dev/projetos/e-sus-urgencias/integracao-com-o-sistema-de-telefonia-digitro","permalink":"/docs-preview/docs/manual-do-dev/projetos/e-sus-urgencias/integracao-com-o-sistema-de-telefonia-digitro","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/02-manual-do-dev/projetos/e-sus-urgencias/integracao-com-o-sistema-de-telefonia-digitro.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Guia para Gerar o APK do Projeto (app-socorrista)","permalink":"/docs-preview/docs/manual-do-dev/projetos/e-sus-urgencias/guia-para-gerar-o-apk-do-projeto-app-socorrista"},"next":{"title":"Links de acesso","permalink":"/docs-preview/docs/manual-do-dev/projetos/e-sus-urgencias/links-de-acesso"}}');var i=s(4848),n=s(8453);const r={},t="Integra\xe7\xe3o com o sistema de Telefonia (Digitro)",d={},c=[{value:"<strong>Principais aspectos da integra\xe7\xe3o</strong>",id:"principais-aspectos-da-integra\xe7\xe3o",level:4},{value:"<strong>Vari\xe1veis de Ambiente</strong>",id:"vari\xe1veis-de-ambiente",level:3},{value:"<strong>Lista de Eventos</strong>",id:"lista-de-eventos",level:5},{value:"<strong>Refer\xeancias</strong>",id:"refer\xeancias",level:3}];function l(e){const a={em:"em",h1:"h1",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,n.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.header,{children:(0,i.jsx)(a.h1,{id:"integra\xe7\xe3o-com-o-sistema-de-telefonia-digitro",children:"Integra\xe7\xe3o com o sistema de Telefonia (Digitro)"})}),"\n",(0,i.jsxs)(a.p,{children:["Este documento descreve a integra\xe7\xe3o do sistema de telefonia com o frontend da aplica\xe7\xe3o, realizada em parceria com a empresa ",(0,i.jsx)(a.strong,{children:"Digitro"}),". O objetivo principal dessa integra\xe7\xe3o \xe9 permitir que os usu\xe1rios efetuem e recebam chamadas diretamente pela interface web."]}),"\n",(0,i.jsxs)(a.p,{children:["A implementa\xe7\xe3o foi feita utilizando a biblioteca ",(0,i.jsx)(a.strong,{children:"jSSIP"}),", um cliente ",(0,i.jsx)(a.strong,{children:"SIP (Session Initiation Protocol)"})," desenvolvido em JavaScript que opera sobre ",(0,i.jsx)(a.strong,{children:"WebRTC"}),". Essa biblioteca possibilita a comunica\xe7\xe3o em tempo real (voz e v\xeddeo) diretamente pelo navegador, sem a necessidade de softwares externos."]}),"\n",(0,i.jsx)(a.h4,{id:"principais-aspectos-da-integra\xe7\xe3o",children:(0,i.jsx)(a.strong,{children:"Principais aspectos da integra\xe7\xe3o"})}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"Protocolo SIP:"})," utilizado para o controle de sess\xe3o e estabelecimento das chamadas."]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"WebRTC:"})," tecnologia base para transmiss\xe3o de \xe1udio via navegador, garantindo baixa lat\xeancia e seguran\xe7a."]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"Autentica\xe7\xe3o e Registro:"})," o frontend realiza o registro SIP com as credenciais fornecidas pela Digitro, permitindo o gerenciamento das extens\xf5es e status de disponibilidade."]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"Eventos de Chamada:"})," o jSSIP gerencia eventos como chamada recebida, em andamento, encerrada ou perdida, permitindo ao frontend atualizar a interface conforme o estado da liga\xe7\xe3o."]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"Interface de Usu\xe1rio:"})," foram adicionados componentes para discagem, exibi\xe7\xe3o de n\xfamero, controle de microfone, e encerramento de chamada."]}),"\n"]}),"\n",(0,i.jsx)(a.h3,{id:"vari\xe1veis-de-ambiente",children:(0,i.jsx)(a.strong,{children:"Vari\xe1veis de Ambiente"})}),"\n",(0,i.jsx)(a.p,{children:"O sistema de telefonia da Digitro utiliza um canal de comunica\xe7\xe3o baseado em SSE (Server-Sent Events) para o envio de eventos em tempo real, como chamadas recebidas, encerramentos e altera\xe7\xf5es de estado dos agentes."}),"\n",(0,i.jsxs)(a.p,{children:["Cada agente \xe9 vinculado a um channel_id, definido a partir do seu user_id no sistema. Esse canal \xe9 aberto no frontend por meio do endpoint ",(0,i.jsx)(a.em,{children:(0,i.jsx)(a.strong,{children:"PHONE_SYSTEM_OPEN_CHANNEL"})}),"."]}),"\n",(0,i.jsxs)(a.p,{children:["Ap\xf3s a abertura, o canal \xe9 assinado atrav\xe9s do endpoint ",(0,i.jsx)(a.em,{children:(0,i.jsx)(a.strong,{children:"PHONE_SYSTEM_SUBSCRIBE_CHANNEL"})}),", permitindo o recebimento dos eventos relacionados especificamente \xe0quele agente."]}),"\n",(0,i.jsx)(a.p,{children:"Durante o processo de inicializa\xe7\xe3o (initPhoneSystemService), o sistema verifica se j\xe1 existe uma assinatura ativa para o mesmo canal antes de criar uma nova. Caso exista, a assinatura \xe9 reutilizada."}),"\n",(0,i.jsx)(a.p,{children:"Essa estrat\xe9gia \xe9 fundamental, pois a Digitro imp\xf5e limites de licen\xe7as e de canais ativos. O reaproveitamento de assinaturas evita exceder esse limite, garantindo a estabilidade da integra\xe7\xe3o e prevenindo erros como \u201ccanal duplicado\u201d ou \u201cassinaturas excedidas\u201d."}),"\n",(0,i.jsx)(a.p,{children:(0,i.jsx)(a.strong,{children:"Al\xe9m disso, todas as a\xe7\xf5es de telefonia (como atender, transferir ou encerrar chamadas) devem ser realizadas exclusivamente por meio dos endpoints oficiais da Digitro."})}),"\n",(0,i.jsx)(a.p,{children:(0,i.jsx)(a.strong,{children:"Embora a biblioteca jSSIP ofere\xe7a fun\xe7\xf5es que poderiam executar algumas dessas opera\xe7\xf5es diretamente, n\xe3o \xe9 recomendado utiliz\xe1-las isoladamente, pois o sistema depende das informa\xe7\xf5es retornadas pelos endpoints (como o call_id) para identificar chamadas e associar suas respectivas grava\xe7\xf5es posteriormente."})}),"\n",(0,i.jsx)(a.h5,{id:"lista-de-eventos",children:(0,i.jsx)(a.strong,{children:"Lista de Eventos"})}),"\n",(0,i.jsxs)(a.p,{children:["Durante o processo de autentica\xe7\xe3o e registro do agente no sistema de telefonia, \xe9 utilizada uma credencial espec\xedfica chamada ",(0,i.jsx)(a.em,{children:(0,i.jsx)(a.strong,{children:"webrtc_password"})}),"."]}),"\n",(0,i.jsx)(a.p,{children:"Essa senha \xe9 respons\xe1vel por autenticar o agente na camada SIP/WebRTC, permitindo que a biblioteca jSSIP estabele\xe7a a sess\xe3o de comunica\xe7\xe3o com o servidor da Digitro."}),"\n",(0,i.jsxs)(a.p,{children:["No backend, o valor do webrtc_password \xe9 definido a partir da vari\xe1vel de ambiente ",(0,i.jsx)(a.strong,{children:"WEBRTC_DEFAULT_PASSWORD e n\xe3o \xe9 exposto diretamente ao frontend."})]}),"\n",(0,i.jsx)(a.p,{children:"Durante a cria\xe7\xe3o do usu\xe1rio de telefonia, o backend executa as seguintes etapas:"}),"\n",(0,i.jsxs)(a.ol,{children:["\n",(0,i.jsx)(a.li,{children:"Recupera o valor de WEBRTC_DEFAULT_PASSWORD."}),"\n",(0,i.jsx)(a.li,{children:"Gera um IV (vetor de inicializa\xe7\xe3o) aleat\xf3rio para criptografia."}),"\n",(0,i.jsx)(a.li,{children:"Criptografa tanto a senha principal (senha do pr\xf3prio usu\xe1rio que vai logar no sistema de telefonia, a mesma que ela usa no Interact MultiAgent) quanto o webrtc_password (senha para se conectar a m\xe1quina da Digitro)."}),"\n",(0,i.jsx)(a.li,{children:"Armazena ambas as senhas de forma segura no banco de dados."}),"\n"]}),"\n",(0,i.jsx)(a.p,{children:"Quando o frontend solicita as credenciais do agente, o backend realiza a descriptografia e retorna apenas as informa\xe7\xf5es necess\xe1rias para o registro SIP."}),"\n",(0,i.jsxs)(a.p,{children:[(0,i.jsxs)(a.strong,{children:["A rota que retorna as credenciais descriptografadas (GET /",":id","/credentials) utiliza os guardas AuthGuard e OwnerGuard, garantindo que cada usu\xe1rio s\xf3 consiga visualizar as pr\xf3prias credenciais."]})," Mesmo que outro agente tente acessar o endpoint de outro usu\xe1rio (exemplo: usu\xe1rio com id 1 tenta acessar /23/credentials), o sistema retorna 403 - Acesso negado, preservando a confidencialidade das senhas."]}),"\n",(0,i.jsx)(a.p,{children:"Essa abordagem garante que nenhuma senha sens\xedvel fique exposta no frontend e que todo o processo de autentica\xe7\xe3o WebRTC siga boas pr\xe1ticas de seguran\xe7a, mantendo a integridade das conex\xf5es e a confidencialidade das credenciais."}),"\n",(0,i.jsx)(a.h3,{id:"refer\xeancias",children:(0,i.jsx)(a.strong,{children:"Refer\xeancias"})}),"\n",(0,i.jsxs)(a.p,{children:[(0,i.jsx)(a.strong,{children:"Edson Machado (Digitro) - Integra\xe7\xe3o:"})," (48) 9628-0268"]}),"\n",(0,i.jsxs)(a.p,{children:[(0,i.jsx)(a.strong,{children:"Rodrigo (Digitro) - Integra\xe7\xe3o:"})," (48) 3281-7344"]}),"\n",(0,i.jsxs)(a.p,{children:[(0,i.jsx)(a.strong,{children:"Lucas Ribeiro (Digitro) - Atendimento ao cliente (normalmente auxilia nas configura\xe7\xf5es de cadastro de novos usu\xe1rios, cria\xe7\xe3o de ramal interno espec\xedfico para um tipo de perfil e basicamente tudo que refere-se ao Interact Manager):"})," (85) 9842-9746"]}),"\n",(0,i.jsxs)(a.p,{children:[(0,i.jsx)(a.strong,{children:"Sidney (DataSUS) - T.I. alocado dentro de onde o SAMU atende em Fortaleza:"})," (85) 9112-0254"]})]})}function m(e={}){const{wrapper:a}={...(0,n.R)(),...e.components};return a?(0,i.jsx)(a,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453(e,a,s){s.d(a,{R:()=>r,x:()=>t});var o=s(6540);const i={},n=o.createContext(i);function r(e){const a=o.useContext(n);return o.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function t(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(n.Provider,{value:a},e.children)}}}]);
"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[2423],{3432(e,a,o){o.r(a),o.d(a,{assets:()=>l,contentTitle:()=>t,default:()=>u,frontMatter:()=>i,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"manual-do-devops/guias/migracao-openclaw-k8s","title":"\ud83e\udd9e Guia Espec\xedfico: Migrando Agentes OpenClaw para Kubernetes","description":"Este guia complementa a migra\xe7\xe3o geral, focando nas particularidades dos Bots OpenClaw (identidade, secrets e config).","source":"@site/docs/03-manual-do-devops/guias/migracao-openclaw-k8s.md","sourceDirName":"03-manual-do-devops/guias","slug":"/manual-do-devops/guias/migracao-openclaw-k8s","permalink":"/docs-preview/docs/manual-do-devops/guias/migracao-openclaw-k8s","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/03-manual-do-devops/guias/migracao-openclaw-k8s.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\ud83d\ude9a Guia de Migra\xe7\xe3o: Legado (Droplet) para Kubernetes","permalink":"/docs-preview/docs/manual-do-devops/guias/migracao-legado-k8s"},"next":{"title":"Cria\xe7\xe3o de E-mail","permalink":"/docs-preview/docs/manual-do-devops/infra/acessos-basicos/6"}}');var s=o(4848),r=o(8453);const i={},t="\ud83e\udd9e Guia Espec\xedfico: Migrando Agentes OpenClaw para Kubernetes",l={},c=[{value:"\ud83c\udfd7\ufe0f Arquitetura Alvo",id:"\ufe0f-arquitetura-alvo",level:2},{value:"1. Prepara\xe7\xe3o no Vault (Seguran\xe7a)",id:"1-prepara\xe7\xe3o-no-vault-seguran\xe7a",level:2},{value:"2. Manifestos Kubernetes",id:"2-manifestos-kubernetes",level:2},{value:"SecretStore &amp; ExternalSecret",id:"secretstore--externalsecret",level:3},{value:"Deployment (O Pulo do Gato \ud83d\udc08)",id:"deployment-o-pulo-do-gato-",level:3},{value:"3. Migra\xe7\xe3o de Dados (C\xe9rebro)",id:"3-migra\xe7\xe3o-de-dados-c\xe9rebro",level:2},{value:"4. A Virada (Kill Switch) \ud83d\udc80",id:"4-a-virada-kill-switch-",level:2}];function d(e){const a={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.header,{children:(0,s.jsx)(a.h1,{id:"-guia-espec\xedfico-migrando-agentes-openclaw-para-kubernetes",children:"\ud83e\udd9e Guia Espec\xedfico: Migrando Agentes OpenClaw para Kubernetes"})}),"\n",(0,s.jsx)(a.p,{children:"Este guia complementa a migra\xe7\xe3o geral, focando nas particularidades dos Bots OpenClaw (identidade, secrets e config)."}),"\n",(0,s.jsx)(a.h2,{id:"\ufe0f-arquitetura-alvo",children:"\ud83c\udfd7\ufe0f Arquitetura Alvo"}),"\n",(0,s.jsxs)(a.p,{children:["No Kubernetes, o agente roda como um ",(0,s.jsx)(a.strong,{children:"Deployment"})," (Stateless/Stateful misto)."]}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"C\xf3digo/Estado:"})," Persistido em PVC (",(0,s.jsx)(a.code,{children:"/root/.openclaw"}),")."]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Segredos:"})," Injetados via ",(0,s.jsx)(a.code,{children:"ExternalSecret"})," (Vault AppRole) -> Env Vars."]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Identidade:"})," Definida pelo Token do Discord (Cuidado com duplicidade!)."]}),"\n"]}),"\n",(0,s.jsx)(a.h2,{id:"1-prepara\xe7\xe3o-no-vault-seguran\xe7a",children:"1. Prepara\xe7\xe3o no Vault (Seguran\xe7a)"}),"\n",(0,s.jsxs)(a.p,{children:["Diferente dos droplets (onde us\xe1vamos token est\xe1tico), no K8s usamos ",(0,s.jsx)(a.strong,{children:"AppRole"}),"."]}),"\n",(0,s.jsxs)(a.ol,{children:["\n",(0,s.jsxs)(a.li,{children:["Crie a Role no Vault:","\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:'vault write auth/approle/role/agente-role token_policies="agents-nome"\n'})}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["Gere ",(0,s.jsx)(a.code,{children:"RoleID"})," e ",(0,s.jsx)(a.code,{children:"SecretID"}),"."]}),"\n",(0,s.jsxs)(a.li,{children:["Crie uma ",(0,s.jsx)(a.strong,{children:"Secret K8s"})," com o ",(0,s.jsx)(a.code,{children:"SecretID"}),":","\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"kubectl create secret generic agente-vault-approle --from-literal=secret-id=...\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(a.h2,{id:"2-manifestos-kubernetes",children:"2. Manifestos Kubernetes"}),"\n",(0,s.jsx)(a.h3,{id:"secretstore--externalsecret",children:"SecretStore & ExternalSecret"}),"\n",(0,s.jsxs)(a.p,{children:["Configure o ",(0,s.jsx)(a.code,{children:"SecretStore"})," apontando para o Vault e o ",(0,s.jsx)(a.code,{children:"ExternalSecret"})," para baixar as chaves (",(0,s.jsx)(a.code,{children:"GH_TOKEN"}),", ",(0,s.jsx)(a.code,{children:"DISCORD_TOKEN"}),", etc)."]}),"\n",(0,s.jsx)(a.h3,{id:"deployment-o-pulo-do-gato-",children:"Deployment (O Pulo do Gato \ud83d\udc08)"}),"\n",(0,s.jsxs)(a.p,{children:["Para evitar que o agente entre em loop de configura\xe7\xe3o ou tente abrir browser sem permiss\xe3o, force o modo ",(0,s.jsx)(a.strong,{children:"local"})," no boot."]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-yaml",children:'    spec:\n      containers:\n      - name: agent\n        image: registry.digitalocean.com/digitalsys/openclaw-agent:latest\n        # Importante: Sem limites para cargas de trabalho pesadas (Dev/Build)\n        # resources: {} \n        env:\n        - name: OPENCLAW_GATEWAY_MODE\n          value: "local"\n        args:\n        - "/bin/bash"\n        - "-c"\n        - |\n          echo "\ud83e\udd16 Booting..."\n          # For\xe7a configura\xe7\xf5es cr\xedticas que as vezes n\xe3o pegam via ENV\n          openclaw config set gateway.mode local\n          openclaw config set plugins.entries.discord.enabled true\n          \n          # Inicia o Gateway\n          openclaw gateway run --verbose\n'})}),"\n",(0,s.jsx)(a.h2,{id:"3-migra\xe7\xe3o-de-dados-c\xe9rebro",children:"3. Migra\xe7\xe3o de Dados (C\xe9rebro)"}),"\n",(0,s.jsx)(a.p,{children:"Se o agente tem mem\xf3ria local importante (reposit\xf3rios clonados, bases vetoriais):"}),"\n",(0,s.jsxs)(a.ol,{children:["\n",(0,s.jsx)(a.li,{children:"Suba o Pod no K8s."}),"\n",(0,s.jsxs)(a.li,{children:["Pare o servi\xe7o no Droplet antigo (",(0,s.jsx)(a.code,{children:"systemctl stop openclaw-gateway"}),")."]}),"\n",(0,s.jsxs)(a.li,{children:["Use ",(0,s.jsx)(a.code,{children:"tar"})," via pipe para copiar:","\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:'ssh root@droplet "tar -C /root/.openclaw -cf - ." | kubectl exec -i pod-name -- tar -C /root/.openclaw -xf -\n'})}),"\n"]}),"\n",(0,s.jsx)(a.li,{children:"Reinicie o Pod para carregar o estado atualizado."}),"\n"]}),"\n",(0,s.jsx)(a.h2,{id:"4-a-virada-kill-switch-",children:"4. A Virada (Kill Switch) \ud83d\udc80"}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"Cr\xedtico:"})," Jamais mantenha o Droplet ligado enquanto o Pod estiver subindo. O Discord bloquear\xe1 a conex\xe3o se detectar dois gateways com o mesmo token (flap)."]}),"\n",(0,s.jsxs)(a.ol,{children:["\n",(0,s.jsxs)(a.li,{children:["Verifique se o Pod est\xe1 ",(0,s.jsx)(a.code,{children:"Running"}),"."]}),"\n",(0,s.jsxs)(a.li,{children:["Imediatamente desligue o Droplet: ",(0,s.jsx)(a.code,{children:"poweroff"}),"."]}),"\n",(0,s.jsxs)(a.li,{children:["Acompanhe os logs do Pod: ",(0,s.jsx)(a.code,{children:"kubectl logs -f deployment/agente"}),"."]}),"\n"]}),"\n",(0,s.jsx)(a.hr,{}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.em,{children:"Adicionado via Cleiton (SRE) - Fev/2026"})})]})}function u(e={}){const{wrapper:a}={...(0,r.R)(),...e.components};return a?(0,s.jsx)(a,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,a,o){o.d(a,{R:()=>i,x:()=>t});var n=o(6540);const s={},r=n.createContext(s);function i(e){const a=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function t(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),n.createElement(r.Provider,{value:a},e.children)}}}]);
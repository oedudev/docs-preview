"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[130],{6891(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>t,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"manual-do-devops/agentes-ia/seguranca-vault","title":"\ud83d\udd10 Gest\xe3o de Segredos: Vault & External Secrets","description":"A seguran\xe7a dos agentes e runners depende da centraliza\xe7\xe3o de credenciais no HashiCorp Vault e sua inje\xe7\xe3o segura no Kubernetes via External Secrets Operator (ESO).","source":"@site/docs/03-manual-do-devops/agentes-ia/seguranca-vault.md","sourceDirName":"03-manual-do-devops/agentes-ia","slug":"/manual-do-devops/agentes-ia/seguranca-vault","permalink":"/docs-preview/docs/manual-do-devops/agentes-ia/seguranca-vault","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/03-manual-do-devops/agentes-ia/seguranca-vault.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\ud83e\udd16 Arquitetura de Agentes de IA no Kubernetes","permalink":"/docs-preview/docs/manual-do-devops/agentes-ia/arquitetura"},"next":{"title":"\ud83c\udfc3\u200d\u2642\ufe0f GitHub Actions Runners no Kubernetes (ARC)","permalink":"/docs-preview/docs/manual-do-devops/ci-cd/runners-k8s"}}');var a=s(4848),o=s(8453);const t={},i="\ud83d\udd10 Gest\xe3o de Segredos: Vault & External Secrets",c={},l=[{value:"Fluxo de Credenciais",id:"fluxo-de-credenciais",level:2},{value:"Como Adicionar/Rotacionar uma Chave",id:"como-adicionarrotacionar-uma-chave",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}];function d(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"-gest\xe3o-de-segredos-vault--external-secrets",children:"\ud83d\udd10 Gest\xe3o de Segredos: Vault & External Secrets"})}),"\n",(0,a.jsx)(n.p,{children:"A seguran\xe7a dos agentes e runners depende da centraliza\xe7\xe3o de credenciais no HashiCorp Vault e sua inje\xe7\xe3o segura no Kubernetes via External Secrets Operator (ESO)."}),"\n",(0,a.jsx)(n.h2,{id:"fluxo-de-credenciais",children:"Fluxo de Credenciais"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Origem (Vault):"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Endere\xe7o: ",(0,a.jsx)(n.code,{children:"http://137.184.157.36:8200"})," (Acesso via VPC interna ",(0,a.jsx)(n.code,{children:"10.116.0.30"})," recomendado)."]}),"\n",(0,a.jsxs)(n.li,{children:["Engine: KV v2 (",(0,a.jsx)(n.code,{children:"kv/"}),")."]}),"\n",(0,a.jsxs)(n.li,{children:["Caminho Padr\xe3o: ",(0,a.jsx)(n.code,{children:"kv/data/agents/&lt;nome-do-agente>"}),"."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Ponte (External Secrets Operator - ESO):"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"O ESO roda no cluster K8s."}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"SecretStore:"})," Define ",(0,a.jsx)(n.em,{children:"como"})," acessar o Vault (Token ou AppRole). Existe um por namespace ou global."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"ExternalSecret:"})," Define ",(0,a.jsx)(n.em,{children:"quais"})," dados buscar.","\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"dataFrom:\n- extract:\n    key: kv/data/agents/roberval\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Destino (Kubernetes Secret):"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["O ESO cria um Secret nativo (ex: ",(0,a.jsx)(n.code,{children:"roberval-env"}),") com os dados decifrados."]}),"\n",(0,a.jsxs)(n.li,{children:["O Deployment monta esse secret como vari\xe1veis de ambiente:","\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"envFrom:\n- secretRef:\n    name: roberval-env\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"como-adicionarrotacionar-uma-chave",children:"Como Adicionar/Rotacionar uma Chave"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Acesse o Vault:"}),"\nVia UI ou CLI (requer token com permiss\xe3o de escrita)."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"export VAULT_ADDR=http://137.184.157.36:8200\nexport VAULT_TOKEN=...\nvault kv patch kv/agents/roberval NOVA_CHAVE=valor_super_secreto\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Sincroniza\xe7\xe3o:"}),"\nO ESO verifica mudan\xe7as a cada 1 minuto (padr\xe3o).\nVerifique se sincronizou:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'kubectl get externalsecret roberval-env-secret -n bots\n# Deve mostrar "SecretSynced"\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Aplica\xe7\xe3o:"}),"\nSe a aplica\xe7\xe3o n\xe3o suporta ",(0,a.jsx)(n.em,{children:"hot-reload"})," de vari\xe1veis de ambiente (a maioria n\xe3o suporta), reinicie o Pod:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl rollout restart deployment/roberval -n bots\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"SecretSynced = False:"})," Verifique se o Token do Vault no ",(0,a.jsx)(n.code,{children:"SecretStore"})," expirou ou se o caminho no ",(0,a.jsx)(n.code,{children:"ExternalSecret"})," est\xe1 correto."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Permiss\xe3o Negada:"})," O token usado pelo ESO deve ter policy de ",(0,a.jsx)(n.code,{children:"read"})," no path ",(0,a.jsx)(n.code,{children:"kv/data/*"}),"."]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>t,x:()=>i});var r=s(6540);const a={},o=r.createContext(a);function t(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);
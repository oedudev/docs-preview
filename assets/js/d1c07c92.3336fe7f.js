"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[6600],{1035(e,s,a){a.r(s),a.d(s,{assets:()=>l,contentTitle:()=>d,default:()=>u,frontMatter:()=>i,metadata:()=>n,toc:()=>t});const n=JSON.parse('{"id":"manual-do-devops/guias/migracao-legado-k8s","title":"\ud83d\ude9a Guia de Migra\xe7\xe3o: Legado (Droplet) para Kubernetes","description":"Este guia descreve o processo utilizado para migrar servi\xe7os stateful (como n8n e Bots) de Droplets isolados para o Cluster Kubernetes.","source":"@site/docs/03-manual-do-devops/guias/migracao-legado-k8s.md","sourceDirName":"03-manual-do-devops/guias","slug":"/manual-do-devops/guias/migracao-legado-k8s","permalink":"/docs-preview/docs/manual-do-devops/guias/migracao-legado-k8s","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/03-manual-do-devops/guias/migracao-legado-k8s.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\ud83c\udfc3\u200d\u2642\ufe0f GitHub Actions Runners no Kubernetes (ARC)","permalink":"/docs-preview/docs/manual-do-devops/ci-cd/runners-k8s"},"next":{"title":"\ud83e\udd9e Guia Espec\xedfico: Migrando Agentes OpenClaw para Kubernetes","permalink":"/docs-preview/docs/manual-do-devops/guias/migracao-openclaw-k8s"}}');var o=a(4848),r=a(8453);const i={},d="\ud83d\ude9a Guia de Migra\xe7\xe3o: Legado (Droplet) para Kubernetes",l={},t=[{value:"Pr\xe9-requisitos",id:"pr\xe9-requisitos",level:2},{value:"Passo a Passo",id:"passo-a-passo",level:2},{value:"1. Prepara\xe7\xe3o (Sem Downtime)",id:"1-prepara\xe7\xe3o-sem-downtime",level:3},{value:"2. Janela de Manuten\xe7\xe3o (Com Downtime)",id:"2-janela-de-manuten\xe7\xe3o-com-downtime",level:3},{value:"3. Virada de Chave",id:"3-virada-de-chave",level:3},{value:"4. Limpeza",id:"4-limpeza",level:3}];function c(e){const s={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.header,{children:(0,o.jsx)(s.h1,{id:"-guia-de-migra\xe7\xe3o-legado-droplet-para-kubernetes",children:"\ud83d\ude9a Guia de Migra\xe7\xe3o: Legado (Droplet) para Kubernetes"})}),"\n",(0,o.jsx)(s.p,{children:"Este guia descreve o processo utilizado para migrar servi\xe7os stateful (como n8n e Bots) de Droplets isolados para o Cluster Kubernetes."}),"\n",(0,o.jsx)(s.h2,{id:"pr\xe9-requisitos",children:"Pr\xe9-requisitos"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["Acesso ",(0,o.jsx)(s.code,{children:"kubectl"})," ao cluster."]}),"\n",(0,o.jsx)(s.li,{children:"Acesso SSH ao Droplet de origem."}),"\n",(0,o.jsx)(s.li,{children:"Manifestos K8s preparados (Deployment, PVC, Service)."}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"passo-a-passo",children:"Passo a Passo"}),"\n",(0,o.jsx)(s.h3,{id:"1-prepara\xe7\xe3o-sem-downtime",children:"1. Prepara\xe7\xe3o (Sem Downtime)"}),"\n",(0,o.jsxs)(s.ol,{children:["\n",(0,o.jsxs)(s.li,{children:["Crie o ",(0,o.jsx)(s.strong,{children:"PVC"})," no Kubernetes."]}),"\n",(0,o.jsxs)(s.li,{children:["Aplique o ",(0,o.jsx)(s.strong,{children:"Deployment"})," com ",(0,o.jsx)(s.code,{children:"replicas: 0"})," (apenas para registrar, n\xe3o subir)."]}),"\n",(0,o.jsxs)(s.li,{children:["Crie um Pod tempor\xe1rio de transfer\xeancia (ex: ",(0,o.jsx)(s.code,{children:"ubuntu"})," ou ",(0,o.jsx)(s.code,{children:"busybox"}),") que monte o PVC em ",(0,o.jsx)(s.code,{children:"/data"}),"."]}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-yaml",children:'# restore-pod.yaml\napiVersion: v1\nkind: Pod\nmetadata: { name: restore, namespace: tools }\nspec:\n  volumes: [{ name: data, persistentVolumeClaim: { claimName: n8n-pvc } }]\n  containers: [{ name: restore, image: ubuntu, command: ["sleep", "infinity"], volumeMounts: [{ mountPath: "/data", name: data }] }]\n'})}),"\n",(0,o.jsx)(s.h3,{id:"2-janela-de-manuten\xe7\xe3o-com-downtime",children:"2. Janela de Manuten\xe7\xe3o (Com Downtime)"}),"\n",(0,o.jsxs)(s.ol,{children:["\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsx)(s.p,{children:(0,o.jsx)(s.strong,{children:"Parar o servi\xe7o no Droplet:"})}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"systemctl stop n8n # ou docker stop ...\n"})}),"\n",(0,o.jsx)(s.p,{children:(0,o.jsx)(s.em,{children:"Isso garante a integridade do banco de dados (SQLite/arquivos)."})}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"Copiar os Dados:"}),"\nUse ",(0,o.jsx)(s.code,{children:"scp"})," para baixar do Droplet para sua m\xe1quina local (buffer) e ",(0,o.jsx)(s.code,{children:"kubectl cp"})," para enviar para o Pod de restore."]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Droplet -> Local\nscp -r root@droplet:/var/lib/docker/volumes/n8n_data/_data/* ./temp_data/\n\n# Local -> K8s PVC\nkubectl cp ./temp_data/ tools/restore:/data/\n"})}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"Ajustar Permiss\xf5es:"}),"\nNo Pod de restore, ajuste o dono dos arquivos (ex: ",(0,o.jsx)(s.code,{children:"1000:1000"})," para node/n8n)."]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"kubectl exec -n tools restore -- chown -R 1000:1000 /data\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(s.h3,{id:"3-virada-de-chave",children:"3. Virada de Chave"}),"\n",(0,o.jsxs)(s.ol,{children:["\n",(0,o.jsx)(s.li,{children:(0,o.jsx)(s.strong,{children:"Deletar o Pod de Restore."})}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Escalar o Deployment:"})," ",(0,o.jsx)(s.code,{children:"kubectl scale deployment n8n --replicas=1"}),"."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Validar Logs:"})," ",(0,o.jsx)(s.code,{children:"kubectl logs -f deployment/n8n"}),"."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Atualizar DNS:"})," Aponte o dom\xednio para o IP do Load Balancer (Ingress)."]}),"\n"]}),"\n",(0,o.jsx)(s.h3,{id:"4-limpeza",children:"4. Limpeza"}),"\n",(0,o.jsx)(s.p,{children:"Ap\xf3s validar o funcionamento no K8s por 24h, o Droplet antigo pode ser desligado e, posteriormente, exclu\xeddo (snapshot recomendado antes)."})]})}function u(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453(e,s,a){a.d(s,{R:()=>i,x:()=>d});var n=a(6540);const o={},r=n.createContext(o);function i(e){const s=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),n.createElement(r.Provider,{value:s},e.children)}}}]);